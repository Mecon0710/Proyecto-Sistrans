CREATE TABLE USUARIO
(
    login VARCHAR2(20)NOT NULL,
    palabraClave VARCHAR2(20)NOT NULL,
    documTipo VARCHAR2(20)NOT NULL,
    documNum NUMBER NOT NULL,
    nombre VARCHAR2(50) NOT NULL,
    nacionalidad VARCHAR2(20) NOT NULL,
    direccFisica VARCHAR2(50) NOT NULL,
    direccElectro VARCHAR2(50) NOT NULL,
    telefono NUMBER NOT NULL,
    ciudad VARCHAR2(20) NOT NULL,
    departamento VARCHAR2(20) NOT NULL,
    codPostal NUMBER NOT NULL,
    CONSTRAINT USU_PK PRIMARY KEY(documNum)
);

INSERT INTO USUARIO (LOGIN,PALABRACLAVE, DOCUMTIPO,DOCUMNUM, NOMBRE, NACIONALIDAD, DIRECCFISICA,DIRECCELECTRO, TELEFONO, CIUDAD, DEPARTAMENTO, CODPOSTAL) 
VALUES ('m.contrerasr','paco','cédula',1000714231, 'Melissa','Colombiana','Cr 82#17-95','melissa_con02@hotmail.com', 3299282, 'Bogotá','Cundinamarca', 10111);
INSERT INTO USUARIO (LOGIN,PALABRACLAVE, DOCUMTIPO,DOCUMNUM, NOMBRE, NACIONALIDAD, DIRECCFISICA,DIRECCELECTRO, TELEFONO, CIUDAD, DEPARTAMENTO, CODPOSTAL) 
VALUES ('k.cohen','flor','cédula',1000345321, 'Kevin','Colombiano','Cr 23 #18-95','kevin_cohen@hotmail.com', 3299812, 'Bogotá','Cundinamarca', 10121);
INSERT INTO USUARIO (LOGIN,PALABRACLAVE, DOCUMTIPO,DOCUMNUM, NOMBRE, NACIONALIDAD, DIRECCFISICA,DIRECCELECTRO, TELEFONO, CIUDAD, DEPARTAMENTO, CODPOSTAL) 
VALUES ('s.rojasv','gato','cédula',1000963547, 'Sara','Colombiano','Cr 77 #15-99','sara_rojas@hotmail.com', 5564868, 'Cali','Valle del Cauca', 20557);


CREATE TABLE ACCION
(   cantidad NUMBER NOT NULL, 
    cantRestric NUMBER NOT NULL,
    numDocumAccion NUMBER,
    CONSTRAINT ACC_PK PRIMARY KEY(numDocumAccion),
    CONSTRAINT FK_USU FOREIGN KEY (numDocumAccion) REFERENCES USUARIO(documNum),
    CONSTRAINT cantidad CHECK (cantidad <= cantRestric)
);

INSERT INTO ACCION (CANTIDAD,CANTRESTRIC,NUMDOCUMACCION)
VALUES (10,25,1000714231);
INSERT INTO ACCION (CANTIDAD,CANTRESTRIC,NUMDOCUMACCION)
VALUES (20,25,1000345321);


CREATE TABLE CLIENTE
(
    idCliente NUMBER GENERATED BY DEFAULT AS IDENTITY,
    tipoPersona VARCHAR(20) NOT NULL,
    numDocumCliente NUMBER,
    CONSTRAINT CLI_PK PRIMARY KEY (idCliente),
    CONSTRAINT FK_CLI FOREIGN KEY (numDocumCliente) REFERENCES USUARIO (documNum)
);

INSERT INTO CLIENTE (IDCLIENTE, TIPOPERSONA,NUMDOCUMCLIENTE)
VALUES (1,'Natural', 1000714231);
INSERT INTO CLIENTE (IDCLIENTE, TIPOPERSONA,NUMDOCUMCLIENTE)
VALUES (2,'Natural', 1000345321);
INSERT INTO CLIENTE (IDCLIENTE, TIPOPERSONA,NUMDOCUMCLIENTE)
VALUES (3,'Natural', 1000963547);


CREATE TABLE EMPLEADO
(
    idEmpleado NUMBER,
    tipoEmpleado VARCHAR(20) NOT NULL,
    numDocumEmpleado NUMBER,
    idClienteEmpleado NUMBER,
    CONSTRAINT EM_PK PRIMARY KEY(idEmpleado),
    CONSTRAINT EM_FK1 FOREIGN KEY (numDocumEmpleado) REFERENCES usuario(documNum),
    CONSTRAINT EM_FK2 FOREIGN KEY (idClienteEmpleado) REFERENCES cliente(idCliente)
);

INSERT INTO EMPLEADO (IDEMPLEADO,TIPOEMPLEADO,NUMDOCUMEMPLEADO,IDCLIENTEEMPLEADO)
VALUES (0, 'Gerente del banco', 1000714231, 1);
INSERT INTO EMPLEADO (IDEMPLEADO,TIPOEMPLEADO,NUMDOCUMEMPLEADO,IDCLIENTEEMPLEADO)
VALUES (1001, 'Gerente general', 1000345321, 2);
INSERT INTO EMPLEADO (IDEMPLEADO,TIPOEMPLEADO,NUMDOCUMEMPLEADO,IDCLIENTEEMPLEADO)
VALUES (2001, 'Gerente de oficina', 1000963547, NULL);


CREATE TABLE PUESTODEATENCION
(
    idPuesto NUMBER GENERATED BY DEFAULT AS IDENTITY,
    tipoDePuesto VARCHAR2(20) NOT NULL,
    localizacion VARCHAR2(50) NOT NULL,
    puestoAtiendeEmpleado NUMBER,
    oficinaDelPuesto VARCHAR2(50),
    CONSTRAINT PU_PK PRIMARY KEY (idPuesto),
    CONSTRAINT PU_FK1 FOREIGN KEY (puestoAtiendeEmpleado) REFERENCES Empleado(idEmpleado),
    CONSTRAINT PU_CK CHECK (puestoAtiendeEmpleado LIKE '1%'OR puestoAtiendeEmpleado LIKE '2%' OR puestoAtiendeEmpleado LIKE '3%'),
    CONSTRAINT PU_FK2 FOREIGN KEY (oficinaDelPuesto) REFERENCES OFICINA(NOMBRE)
);

INSERT INTO PUESTODEATENCION (IDPUESTO, TIPODEPUESTO, LOCALIZACION, PUESTOATIENDEEMPLEADO, OFICINADELPUESTO)
VALUES (1,'Oficina','Cr83#52-22',1001,'W101');
INSERT INTO PUESTODEATENCION (IDPUESTO, TIPODEPUESTO, LOCALIZACION, PUESTOATIENDEEMPLEADO, OFICINADELPUESTO)
VALUES (2,'Oficina','Cr83#52-22',2001,'C203');


CREATE TABLE OFICINA
(
    nombre VARCHAR(20),
    direccion VARCHAR(20) NOT NULL UNIQUE ,
    empleadoDeOficina NUMBER UNIQUE,
    CONSTRAINT OF_PK PRIMARY KEY(nombre),
    CONSTRAINT OF_FK FOREIGN KEY(empleadoDeOficina) REFERENCES EMPLEADO(idEmpleado),
    CONSTRAINT empleadoDeOficina CHECK (empleadoDeOficina<3000)
);

INSERT INTO OFICINA (NOMBRE, DIRECCION, EMPLEADODEOFICINA)
VALUES ('W101','Cr83#52-22',1001);
INSERT INTO OFICINA (NOMBRE, DIRECCION, EMPLEADODEOFICINA)
VALUES ('C203','Cr83#52-29',2001);


CREATE TABLE CUENTA
(
    codigo NUMBER,
    tipoCuenta VARCHAR2(20) NOT NULL,
    estaCerrada VARCHAR2(20) NOT NULL,
    clienteTieneCuenta NUMBER,
    saldo NUMBER NOT NULL,
    CONSTRAINT CU_PK PRIMARY KEY (codigo),
    CONSTRAINT CU_FK FOREIGN KEY (clienteTieneCuenta) REFERENCES CLIENTE(idCliente),
    CONSTRAINT CU_CK1 CHECK (estaCerrada = 'Sí' OR estaCerrada = 'No')
    CONSTRAINT CU_CK2 CHECK (saldo >= 10000)
);

INSERT INTO CUENTA (CODIGO, TIPOCUENTA, ESTACERRADA, CLIENTETIENECUENTA,SALDO)
VALUES (2587419635, 'AHORROS', 'No',1,100000);
INSERT INTO CUENTA (CODIGO, TIPOCUENTA, ESTACERRADA, CLIENTETIENECUENTA,SALDO)
VALUES (1830418340, 'DÉBITO', 'No',1,1000000);
INSERT INTO CUENTA (CODIGO, TIPOCUENTA, ESTACERRADA, CLIENTETIENECUENTA,SALDO)
VALUES (2587147693, 'DÉBITO', 'No',2,200000);
INSERT INTO CUENTA (CODIGO, TIPOCUENTA, ESTACERRADA, CLIENTETIENECUENTA,SALDO)
VALUES (1223455667, 'CRÉDITO', 'No',3, 300000);


CREATE TABLE CDT
(
    fecha DATE NOT NULL,
    estado VARCHAR(20) NOT NULL,
    cdtEsCuenta NUMBER,
    CONSTRAINT CDT_PK PRIMARY KEY (cdtEsCuenta),
    CONSTRAINT CDT_FK FOREIGN KEY (cdtEsCuenta) REFERENCES CUENTA(codigo)
);

INSERT INTO CDT (FECHA, ESTADO, CDTESCUENTA)
VALUES (DATE '2021-10-17', 'ABIERTO', 2587419635);
INSERT INTO CDT (FECHA, ESTADO, CDTESCUENTA)
VALUES (DATE '2021-10-17', 'CERRADO', 2587147693);


CREATE TABLE DEPOSITODEINVERSION
(
    depositoDeInversionEsCuenta NUMBER,
    CONSTRAINT DEP_FK FOREIGN KEY (depositoDeInversionEsCuenta) REFERENCES CUENTA(codigo),
    CONSTRAINT DEP_PK PRIMARY KEY (depositoDeInversionEsCuenta)
);

INSERT INTO DEPOSITODEINVERSION (depositoDeInversionEsCuenta)
VALUES (1223455667);
INSERT INTO DEPOSITODEINVERSION (depositoDeInversionEsCuenta)
VALUES (2587147693);


CREATE TABLE PRESTAMO
(
    idPrestamo NUMBER GENERATED BY DEFAULT AS IDENTITY,
    tipoPrestamo VARCHAR(20) NOT NULL,
    monto NUMBER NOT NULL,
    interes NUMBER NOT NULL, 
    numCuotas NUMBER NOT NULL,
    diaPago DATE NOT NULL,
    valorMinCuo NUMBER NOT NULL,
    estaCerrada VARCHAR(5) NOT NULL, 
    deudaActual NUMBER NOT NULL,
    empleadoEncargado NUMBER,
    clientePerteneciente NUMBER,
    cuentaPerteneciente NUMBER, 
    CONSTRAINT PRES_PK PRIMARY KEY (idPrestamo),
    CONSTRAINT PRES_FK1 FOREIGN KEY (empleadoEncargado)REFERENCES EMPLEADO(idEmpleado),
    CONSTRAINT PRES_FK2 FOREIGN KEY (clientePerteneciente)REFERENCES CLIENTE (idCliente),
    CONSTRAINT PRES_FK3 FOREIGN KEY (cuentaPerteneciente)REFERENCES CUENTA (codigo),
    CONSTRAINT empleadoEncargado CHECK (empleadoEncargado = 0)
);

INSERT INTO PRESTAMO(IDPRESTAMO,TIPOPRESTAMO,MONTO,INTERES,NUMCUOTAS,DIAPAGO,VALORMINCUO,ESTACERRADA,DEUDAACTUAL,EMPLEADOENCARGADO,CLIENTEPERTENECIENTE,CUENTAPERTENECIENTE)
VALUES (1, 'PARA VIVIENDA', 1000000, 1.5, 3, DATE '2020-10-17', 500000, 'No', 800000, 0, 2, 2587419635);
INSERT INTO PRESTAMO(IDPRESTAMO,TIPOPRESTAMO,MONTO,INTERES,NUMCUOTAS,DIAPAGO,VALORMINCUO,ESTACERRADA,DEUDAACTUAL,EMPLEADOENCARGADO,CLIENTEPERTENECIENTE,CUENTAPERTENECIENTE)
VALUES (2, 'PARA ESTUDIO', 20000000, 2.5, 5, DATE '2020-10-20', 800000, 'No', 800000, 0, 3, 1223455667); 


CREATE TABLE OPERACION
(
    idOperacion NUMBER GENERATED BY DEFAULT AS IDENTITY,
    tipo VARCHAR2(20) NOT NULL,
    valor NUMBER NOT NULL,
    horaYfecha TIMESTAMP(2) NOT NULL,
    puestoParaOperacion NUMBER,
    CONSTRAINT OP_PK PRIMARY KEY (idOperacion),
    CONSTRAINT OP_FK FOREIGN KEY (puestoParaOperacion) REFERENCES PUESTODEATENCION(idPuesto)
);

INSERT INTO OPERACION (IDOPERACION,TIPO,VALOR,HORAYFECHA,PUESTOPARAOPERACION)
VALUES (1,'SOLICITAR', 100000, LOCALTIMESTAMP(2), 1);
INSERT INTO OPERACION (IDOPERACION,TIPO,VALOR,HORAYFECHA,PUESTOPARAOPERACION)
VALUES (2,'ABRIR', 10000,LOCALTIMESTAMP(2), 1);
INSERT INTO OPERACION (IDOPERACION,TIPO,VALOR,HORAYFECHA,PUESTOPARAOPERACION)
VALUES (3,'ABRIR', 100000, LOCALTIMESTAMP(2), 1);
INSERT INTO OPERACION (IDOPERACION,TIPO,VALOR,HORAYFECHA,PUESTOPARAOPERACION)
VALUES (4,'ABRIR', 100000, LOCALTIMESTAMP(2), 1);
INSERT INTO OPERACION (IDOPERACION,TIPO,VALOR,HORAYFECHA,PUESTOPARAOPERACION)
VALUES (5,'CONSIGNAR', 100000, LOCALTIMESTAMP(2), 2);


CREATE TABLE OPPRESTAMO
(
    idOperacionPrestamo NUMBER,
    operacionDePrestamo NUMBER,
    CONSTRAINT OPP_PK PRIMARY KEY (idOperacionPrestamo),
    CONSTRAINT OPP_FK1 FOREIGN KEY (idOperacionPrestamo) REFERENCES OPERACION(idOperacion),
    CONSTRAINT OPP_FK2 FOREIGN KEY (operacionDePrestamo) REFERENCES PRESTAMO(idPrestamo)
);

INSERT INTO OPPRESTAMO (IDOPERACIONPRESTAMO, OPERACIONDEPRESTAMO)
VALUES(1,1);
INSERT INTO OPPRESTAMO (IDOPERACIONPRESTAMO, OPERACIONDEPRESTAMO)
VALUES(2,1);


CREATE TABLE OPCUENTA
(
    idOperacionCuenta NUMBER,
    operacionDeCuenta NUMBER NOT NULL,
    CONSTRAINT OPCU_PK PRIMARY KEY (idOperacionCuenta),
    CONSTRAINT OPCU_FK1 FOREIGN KEY (idOperacionCuenta) REFERENCES OPERACION(idOperacion),
    CONSTRAINT OPCU_FK2 FOREIGN KEY (operacionDeCuenta) REFERENCES CUENTA(codigo)
);

INSERT INTO OPCUENTA(IDOPERACIONCUENTA,OPERACIONDECUENTA)
VALUES(1,2587419635);
INSERT INTO OPCUENTA(IDOPERACIONCUENTA,OPERACIONDECUENTA)
VALUES(2,1223455667);
INSERT INTO OPCUENTA(IDOPERACIONCUENTA,OPERACIONDECUENTA)
VALUES(3,2587419635);
INSERT INTO OPCUENTA(IDOPERACIONCUENTA,OPERACIONDECUENTA)
VALUES(4,1830418340);
INSERT INTO OPCUENTA(IDOPERACIONCUENTA,OPERACIONDECUENTA)
VALUES(5,1830418340);


CREATE TABLE OPCDT
(
    idOperacionCDT NUMBER,
    operacionCDT  NUMBER,
    CONSTRAINT OPCDT_PK PRIMARY KEY (idOperacionCDT),
    CONSTRAINT OPCDT_FK1 FOREIGN KEY (idOperacionCDT) REFERENCES OPERACION(idOperacion),
    CONSTRAINT OPCDT_FK2 FOREIGN KEY (operacionCDT) REFERENCES CDT(cdtEsCuenta)
);

INSERT INTO OPCDT(IDOPERACIONCDT,OPERACIONCDT)
VALUES(1,2587419635);
INSERT INTO OPCDT(IDOPERACIONCDT,OPERACIONCDT)
VALUES(2,2587147693);


CREATE TABLE OPDEPOSITO
(
    idOperacionDeposito NUMBER,
    operacionDeDeposito NUMBER NOT NULL,
    CONSTRAINT OPDEP_PK PRIMARY KEY (idOperacionDeposito),
    CONSTRAINT OPDEP_FK1 FOREIGN KEY (idOperacionDeposito) REFERENCES OPERACION(idOperacion),
    CONSTRAINT OPDEP_FK2 FOREIGN KEY (operacionDeDeposito) REFERENCES DEPOSITODEINVERSION(depositoDeInversionEsCuenta)
);

INSERT INTO OPDEPOSITO(IDOPERACIONDEPOSITO,OPERACIONDEDEPOSITO)
VALUES(1,1223455667);
INSERT INTO OPDEPOSITO(IDOPERACIONDEPOSITO,OPERACIONDEDEPOSITO)
VALUES(2,2587147693);

commit;